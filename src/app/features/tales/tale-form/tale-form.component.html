<!--
  ~  Copyright 2025 Elias Taufer
  ~
  ~   Licensed under the Apache License, Version 2.0 (the "License");
  ~   you may not use this file except in compliance with the License.
  ~   You may obtain a copy of the License at
  ~
  ~       http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~   Unless required by applicable law or agreed to in writing, software
  ~   distributed under the License is distributed on an "AS IS" BASIS,
  ~   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~   See the License for the specific language governing permissions and
  ~   limitations under the License.
  -->

<section class="card vstack">
  <h2>{{ (editId ? 'TALE.EDIT_TALE' : 'TALE.ADD_TALE') | t }}</h2>

  <form (ngSubmit)="save()" #f="ngForm" class="vstack">

    <div class="form-row two-cols">
      <div class="form-field">
        <label for="title">{{ 'COMMON.TITLE' | t }}</label>
        <input class="input" id="title" name="title" [(ngModel)]="model.title" required />
      </div>

      <div class="form-field">
        <label for="author">{{ 'COMMON.AUTHOR' | t }}</label>
        <input class="input" id="author" name="author" [(ngModel)]="model.author" required />
      </div>
    </div>

    <div class="form-row two-cols">
      <div class="form-field">
        <label for="tags">Tags (comma separated)</label>
        <input class="input" id="tags" name="tags" [(ngModel)]="model.tags"/>
      </div>

      <div class="form-field">
        <label for="publishedYear">{{ 'TALE.PUBLISHED_YEAR' | t }}</label>
        <input class="input" id="publishedYear" name="publishedYear" type="number" [(ngModel)]="model.publishedYear"/>
      </div>
    </div>

    <div class="form-row two-cols">
      <div class="form-field">
        <label for="coverUrl">{{ 'TALE.COVER_URL' | t }}</label>
        <input class="input" id="coverUrl" name="coverUrl" [(ngModel)]="model.coverUrl"/>
      </div>

      <div class="form-field">
        <label for="isbn">{{ 'TALE.ISBN' | t }}</label>
        <div class="input-row">
          <input class="input" id="isbn" name="isbn" [(ngModel)]="model.isbn" />

          @if (!editId) {
            <button
              type="button"
              class="btn"
              (click)="loadFromOpenLibrary()"
              [disabled]="importing || saving || !model.isbn"
              title="Load from Open Library"
            >
              @if (importing) {
                {{ 'COMMON.LOADING' | t }}...
              } @else {
                {{ 'TALE.LOAD_OPEN_LIB' | t }}
              }
            </button>
          }
        </div>
      </div>
    </div>

    <div class="form-field">
      <label for="description">{{ 'COMMON.DESCRIPTION' | t }}</label>
      <textarea id="description" name="description" rows="5" [(ngModel)]="model.description"></textarea>
    </div>

    <div class="hstack" style="gap:8px;">
      <button class="btn btn-primary" type="submit" [disabled]="saving || !f.form.valid">
        {{ saving ? (editId ? 'Updating…' : 'Saving…') : (editId ? 'Update' : 'Save') }}
      </button>
      <a class="btn" href="" (click)="$event.preventDefault(); goBack()">{{ 'COMMON.CANCEL' | t }}</a>
    </div>

    @if (error) {
      <p class="error">{{ error }}</p>
    }
  </form>
</section>
